(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.3' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     11674,        334]
NotebookOptionsPosition[      9873,        290]
NotebookOutlinePosition[     10297,        306]
CellTagsIndexPosition[     10254,        303]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Environment", "Section",
 CellChangeTimes->{{3.7432095133994513`*^9, 3.7432095380562754`*^9}, {
  3.7432096532238245`*^9, 3.7432096553820567`*^9}, {3.7432099521947155`*^9, 
  3.7432099581966724`*^9}},ExpressionUUID->"cdb2ab94-521e-4a8b-ad79-\
76709094127a"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"$here", "=", 
   RowBox[{"NotebookDirectory", "[", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"$time", "=", "Now"}]}], "Input",
 CellChangeTimes->{{3.743209948179452*^9, 3.7432100097519064`*^9}},
 CellLabel->
  "In[147]:=",ExpressionUUID->"2422e458-a591-463e-9b7e-f65be2fda8b9"],

Cell[BoxData[
 TemplateBox[{RowBox[{"\"Tue 21 Aug 2018 20:45:00\"", 
     StyleBox[
      RowBox[{"\"GMT+\"", "\[InvisibleSpace]", 
        StyleBox["8.`", NumberMarks -> False, StripOnInput -> False]}], 
      FontColor -> GrayLevel[0.5]]}],RowBox[{"DateObject", "[", 
     RowBox[{
       RowBox[{"{", 
         RowBox[{
          "2018", ",", "8", ",", "21", ",", "20", ",", "45", ",", 
           "0.0486277`6.439458717890571"}], "}"}], ",", "\"Instant\"", ",", 
       "\"Gregorian\"", ",", "8.`"}], "]"}]},
  "DateObject",
  Editable->False]], "Output",
 CellChangeTimes->{{3.7432100069344025`*^9, 3.742950813257194*^9}, 
   3.743450544080514*^9, 3.7434516760112233`*^9, 3.743451829837222*^9, 
   3.74384430006279*^9},
 CellLabel->
  "Out[148]=",ExpressionUUID->"e2708947-af29-429f-8fb6-81bff71735c5"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["DataLoader", "Section",
 CellChangeTimes->{{3.7432095133994513`*^9, 3.7432095380562754`*^9}, {
  3.7432096532238245`*^9, 
  3.7432096553820567`*^9}},ExpressionUUID->"7a803996-0820-4645-9b24-\
52783b819adc"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "imageSample", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"\"\<Size\>\"", "\[Rule]", "64"}], "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"imageSample", "[", 
    RowBox[{"img_", ",", 
     RowBox[{"t_", ":", "25"}], ",", 
     RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
   RowBox[{"Block", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"x", ",", "y", ",", 
       RowBox[{"s", "=", 
        RowBox[{"OptionValue", "[", "\"\<Size\>\"", "]"}]}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"x", ",", "y"}], "}"}], "=", 
       RowBox[{"ImageDimensions", "[", "img", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"ImageTrim", "[", 
           RowBox[{"img", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"#1", ",", "#2"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"#1", "+", "s", "-", "2"}], ",", 
                RowBox[{"#2", "+", "s", "-", "2"}]}], "}"}]}], "}"}]}], "]"}],
           "&"}], "[", 
         RowBox[{
          RowBox[{"RandomInteger", "[", 
           RowBox[{"x", "-", "s", "+", "2"}], "]"}], ",", 
          RowBox[{"RandomInteger", "[", 
           RowBox[{"y", "-", "s", "+", "2"}], "]"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "t"}], "}"}]}], "]"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"doPack", "[", 
    RowBox[{"files_", ",", 
     RowBox[{"pick_", ":", "100"}], ",", 
     RowBox[{"size_", ":", "64"}]}], "]"}], ":=", 
   RowBox[{"Block", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"rsp", ",", "rnd"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"rsp", "=", 
       RowBox[{"Take", "[", 
        RowBox[{
         RowBox[{"FileNames", "[", 
          RowBox[{"\"\<*\>\"", ",", "\"\<D:\\\\DeepLearning\\\\Pixiv\>\""}], 
          "]"}], ",", 
         RowBox[{"UpTo", "[", "files", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"rnd", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"imageSample", "[", 
           RowBox[{
            RowBox[{"First", "[", 
             RowBox[{"Image`ImportExportDump`ImageReadPNG", "@", "#"}], "]"}],
             ",", "pick", ",", 
            RowBox[{"\"\<Size\>\"", "\[Rule]", "size"}]}], "]"}], "&"}], "/@",
          "rsp"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"ImageResize", "[", 
          RowBox[{"#", ",", 
           RowBox[{"Scaled", "[", 
            RowBox[{"1", "/", "2"}], "]"}]}], "]"}], "\[Rule]", "#"}], "&"}], 
       "/@", 
       RowBox[{"Select", "[", 
        RowBox[{
         RowBox[{"Flatten", "[", "rnd", "]"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"Total", "@", 
            RowBox[{"Variance", "[", "#", "]"}]}], ">", "0.005"}], "&"}]}], 
        "]"}]}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.7431995440681787`*^9, 3.7431995626086226`*^9}, {
   3.7432028980377736`*^9, 3.7432029573184366`*^9}, {3.743206243603016*^9, 
   3.7432062437709417`*^9}, {3.743206555892602*^9, 3.743206556102042*^9}, {
   3.743206598800914*^9, 3.7432066532842865`*^9}, {3.7432071437621136`*^9, 
   3.7432071453867707`*^9}, {3.743207208873102*^9, 3.7432072125632744`*^9}, {
   3.7432072781505356`*^9, 3.7432072784137964`*^9}, 3.7432084044747186`*^9, {
   3.7432094492051115`*^9, 3.7432094894444804`*^9}, {3.7432096584388857`*^9, 
   3.7432097087474174`*^9}, {3.7434503080609426`*^9, 3.74345035347143*^9}, {
   3.7434503849492207`*^9, 3.743450404835023*^9}, {3.7434504404796667`*^9, 
   3.7434504632806697`*^9}, {3.7434506639161587`*^9, 
   3.7434506747930346`*^9}, {3.7438441332574387`*^9, 3.7438441466077557`*^9}},
 CellLabel->
  "In[136]:=",ExpressionUUID->"b5caf2af-7872-419a-93fe-17846dac60bf"],

Cell[CellGroupData[{

Cell["Training Data", "Subsection",
 CellChangeTimes->{{3.7432095133994513`*^9, 3.7432095380562754`*^9}, {
  3.7432096532238245`*^9, 3.7432096553820567`*^9}, {3.7438442788163795`*^9, 
  3.7438442809187593`*^9}},ExpressionUUID->"de55a989-fd24-4500-ba12-\
5ce0e9d66b20"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"pack", "=", 
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"ColorConvert", "[", 
        RowBox[{"#", ",", "\"\<Grayscale\>\""}], "]"}], "&"}], ",", 
      RowBox[{"doPack", "[", 
       RowBox[{"200", ",", "25", ",", "128"}], "]"}], ",", 
      RowBox[{"{", "2", "}"}]}], "]"}]}], ";"}], "//", 
  "TT"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Export", "[", 
   RowBox[{
    RowBox[{"FileNameJoin", "[", 
     RowBox[{"{", 
      RowBox[{"$here", ",", "\"\<Pixiv5000_1\[Times]128\[Times]128.WXF\>\""}],
       "}"}], "]"}], ",", "pack", ",", 
    RowBox[{"PerformanceGoal", "\[Rule]", "\"\<Size\>\""}]}], "]"}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.743450476811472*^9, 3.7434505278988028`*^9}, {
   3.743450581898546*^9, 3.743450595579983*^9}, {3.7434508000698957`*^9, 
   3.7434508345147753`*^9}, 3.7434508835636005`*^9, {3.743451686908037*^9, 
   3.7434517624629126`*^9}, {3.743451824621176*^9, 3.7434518276301255`*^9}, 
   3.7438442907285404`*^9},ExpressionUUID->"3fcd992d-bc08-4907-9216-\
5a0e50baa7a2"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  TagBox["\<\"CPU Time: \"\>",
   "EchoLabel"], " ", "7.4375`"}]], "Echo",
 CellChangeTimes->{
  3.743451841480076*^9},ExpressionUUID->"3abefc0c-9787-4445-ba04-\
dc70400ae620"],

Cell[BoxData[
 RowBox[{
  TagBox["\<\"All Time: \"\>",
   "EchoLabel"], " ", "9.390166645565246`"}]], "Echo",
 CellChangeTimes->{
  3.7434518415010214`*^9},ExpressionUUID->"3cd4ee03-17ee-4a9d-8d18-\
d1ed5fa694bc"]
}, Open  ]]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Benchmark Data", "Subsection",
 CellChangeTimes->{{3.7432095133994513`*^9, 3.7432095380562754`*^9}, {
   3.7432096532238245`*^9, 3.7432096553820567`*^9}, {3.743844049965104*^9, 
   3.743844059396859*^9}, 
   3.743844283523797*^9},ExpressionUUID->"6c659db5-8f8e-4953-b898-\
b787caad2f96"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"name", "=", 
   RowBox[{"FileNameJoin", "[", 
    RowBox[{"{", 
     RowBox[{"$here", ",", "\"\<Benchmark_3\[Times]512\[Times]512.WXF\>\""}], 
     "}"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Export", "[", 
    RowBox[{"name", ",", 
     RowBox[{"doPack", "[", 
      RowBox[{"100", ",", "1", ",", "512"}], "]"}], ",", 
     RowBox[{"PerformanceGoal", "\[Rule]", "\"\<Size\>\""}]}], "]"}], ";"}], "//",
   "TT"}]}], "Input",
 CellChangeTimes->{{3.743844079084237*^9, 3.7438441039118757`*^9}, 
   3.743844160547531*^9, {3.7438442007460513`*^9, 3.743844246790017*^9}},
 CellLabel->
  "In[145]:=",ExpressionUUID->"1d29b2a9-afbb-41f9-ad79-a8a363063918"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  TagBox["\<\"CPU Time: \"\>",
   "EchoLabel"], " ", "5.75`"}]], "Echo",
 CellChangeTimes->{
  3.743844256204817*^9},ExpressionUUID->"249ad04d-d712-4e7d-a44a-\
e54e1e01eae9"],

Cell[BoxData[
 RowBox[{
  TagBox["\<\"All Time: \"\>",
   "EchoLabel"], " ", "7.920189143363843`"}]], "Echo",
 CellChangeTimes->{
  3.743844256218779*^9},ExpressionUUID->"fc88b791-6a4d-4b74-a166-\
79927dc89125"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}, Open  ]]
},
WindowSize->{1108, 625},
WindowMargins->{{284, Automatic}, {Automatic, 171}},
FrontEndVersion->"11.3 for Microsoft Windows (64-bit) (March 6, 2018)",
StyleDefinitions->FrontEnd`FileName[{"Wolfram"}, "ProgrammingLabDefault.nb", 
  CharacterEncoding -> "UTF-8"]
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 263, 4, 67, "Section",ExpressionUUID->"cdb2ab94-521e-4a8b-ad79-76709094127a"],
Cell[CellGroupData[{
Cell[868, 30, 320, 7, 53, "Input",ExpressionUUID->"2422e458-a591-463e-9b7e-f65be2fda8b9"],
Cell[1191, 39, 807, 18, 44, "Output",ExpressionUUID->"e2708947-af29-429f-8fb6-81bff71735c5"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[2047, 63, 212, 4, 67, "Section",ExpressionUUID->"7a803996-0820-4645-9b24-52783b819adc"],
Cell[2262, 69, 4172, 106, 273, "Input",ExpressionUUID->"b5caf2af-7872-419a-93fe-17846dac60bf"],
Cell[CellGroupData[{
Cell[6459, 179, 268, 4, 53, "Subsection",ExpressionUUID->"de55a989-fd24-4500-ba12-5ce0e9d66b20"],
Cell[CellGroupData[{
Cell[6752, 187, 1091, 27, 53, "Input",ExpressionUUID->"3fcd992d-bc08-4907-9216-5a0e50baa7a2"],
Cell[CellGroupData[{
Cell[7868, 218, 200, 6, 23, "Echo",ExpressionUUID->"3abefc0c-9787-4445-ba04-dc70400ae620"],
Cell[8071, 226, 213, 6, 23, "Echo",ExpressionUUID->"3cd4ee03-17ee-4a9d-8d18-d1ed5fa694bc"]
}, Open  ]]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[8345, 239, 293, 5, 53, "Subsection",ExpressionUUID->"6c659db5-8f8e-4953-b898-b787caad2f96"],
Cell[CellGroupData[{
Cell[8663, 248, 721, 18, 53, "Input",ExpressionUUID->"1d29b2a9-afbb-41f9-ad79-a8a363063918"],
Cell[CellGroupData[{
Cell[9409, 270, 198, 6, 23, "Echo",ExpressionUUID->"249ad04d-d712-4e7d-a44a-e54e1e01eae9"],
Cell[9610, 278, 211, 6, 23, "Echo",ExpressionUUID->"fc88b791-6a4d-4b74-a166-79927dc89125"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}
]
*)

